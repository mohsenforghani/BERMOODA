<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bermooda - Mohsen Forghani</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    height: 100%;
    touch-action: none;
    user-select: none;
   -webkit-user-select: none;
  }

  canvas {
    display: block;
    background: black;
  }

#gameTitle {
  position: absolute;
  top: 30%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 50px;
  font-weight: bold;
  color: #00ffcc;
  font-family: 'Arial Black', sans-serif;
  text-shadow:
    0 0 2px #00ffcc,
    0 0 4px #00ffcc,
    0 0 6px #00ffff,
    0 0 8px #00ffff;
    z-index: 1000;
    
}

  /* ØµÙØ­Ù‡ Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
  #loadingScreen {
    position: fixed;
    inset: 0;
    background: linear-gradient(180deg, #000, #111);
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: sans-serif;
    z-index: 1000;
  }

  #loadingText {
    font-size: 11px;
    margin-top: 18px;
    text-align: center; /* ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† */
  }

  #progressBar {
    width: 60%;
    height: 12px;
    border: 1px solid #444;
    border-radius: 6px;
    overflow: hidden;
    background: #222;
  }

  #progressFill {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #00ff88, #00ffff);
    border-radius: 8px;
    transition: width 0.2s ease;
  }

#logoText {
  font-size: 50px;
  font-weight: bold;
  color: #00ffcc;
  margin-bottom: 40px;
  font-family: 'Arial Black', sans-serif;
  text-shadow:
    0 0 5px #00ffcc,
    0 0 10px #00ffcc,
    0 0 20px #00ffff,
    0 0 30px #00ffff;
  animation: glow 1.5s ease-in-out infinite alternate;
}

#subLogoText {
  font-size: 15px;
  color: #00ffcc;
  font-family: 'Arial', sans-serif;
  text-shadow: 0 0 3px #00ffcc, 0 0 5px #00ffff;
  margin-bottom: 30px; /* ÙØ§ØµÙ„Ù‡ Ø§Ø² BERMOODA */
 // animation: glow 1.5s ease-in-out infinite alternate;
}

@keyframes glow {
  0% {
    text-shadow:
      0 0 5px #00ffcc,
      0 0 10px #00ffcc,
      0 0 20px #00ffff,
      0 0 30px #00ffff;
    transform: scale(1);
  }
  100% {
    text-shadow:
      0 0 10px #00ffcc,
      0 0 20px #00ffcc,
      0 0 40px #00ffff,
      0 0 60px #00ffff;
    transform: scale(1.2);
  }
}


  #scoreBtn {
  position: absolute;
  width: 300px;     /* Ø¹Ø±Ø¶ ÛŒÚ©Ø³Ø§Ù† */
  padding: 12px 0;  /* ÙÙ‚Ø· Ø§Ø±ØªÙØ§Ø¹ Ø¯Ú©Ù…Ù‡ */
  bottom: 27%; 
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #00c3ff, #0072ff);
  color: white;
  white-space: nowrap;
  border: none;
  border-radius: 25px;
  font-size: 20px;
  font-family: 'Calibri', sans-serif;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 20px rgba(0, 114, 255, 0.6);
  transition: all 0.3s ease;
  display: none; /* Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ø¯ */
  z-index: 999;
}
#startBtn {
  position: absolute;
  width: 300px;     /* Ø¹Ø±Ø¶ ÛŒÚ©Ø³Ø§Ù† */
  padding: 12px 0;  /* ÙÙ‚Ø· Ø§Ø±ØªÙØ§Ø¹ Ø¯Ú©Ù…Ù‡ */
  bottom: 36%; 
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #00c3ff, #0072ff);
  color: white;
  white-space: nowrap;
  border: none;
  border-radius: 25px;
  font-size: 20px;
  font-family: 'Calibri', sans-serif;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 20px rgba(0, 114, 255, 0.6);
  transition: all 0.3s ease;
  display: none; /* Ø§ÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ù…Ø®ÙÛŒ Ø¨Ø§Ø´Ø¯ */
  z-index: 999;
}

#startBtn:hover {
  background: linear-gradient(135deg, #33ccff, #0066ff);
  transform: translateX(-50%) scale(1.08);
  box-shadow: 0 0 25px rgba(0, 114, 255, 0.9);
}

#startBtn:active {
  transform: translateX(-50%) scale(0.95);
}

#scoreBtn:hover {
  background: linear-gradient(135deg, #33ccff, #0066ff);
  transform: translateX(-50%) scale(1.08);
  box-shadow: 0 0 25px rgba(0, 114, 255, 0.9);
}

#scoreBtn:active {
  transform: translateX(-50%) scale(0.95);
}

  #creatorName {
    position: absolute;
    bottom: 10px;
    right: 10px;
    font-size: 10px;
    color: rgba(255,255,255,0.5);
    font-style: italic;
    pointer-events: none;
    z-index: 10;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    font-family: Arial, sans-serif;
  }

  /* ğŸ® Ø¬ÙˆÛŒâ€ŒØ§Ø³ØªÛŒÚ© */
  #joystick {
    position: absolute;
    bottom: 30px;
    right: 20px;
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.1);
    border: 3px solid rgba(255,255,255,0.4);
    border-radius: 50%;
   display = "none"
   z-index: 1000;

  }

  #stick {
    position: absolute;
    width: 30px;
    height:30px;
    background: orange;
    border-radius: 50%;
    top: 25px;
    left: 25px;
    transition: 0.05s;
    display = "none"
    z-index: 1000;
  }

  #shoot {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 50px;
    height: 50px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    color: white;
    font-size: 25px;
    text-align: center;
    line-height: 50px;
    user-select: none;
    display = "none"
    z-index: 1000;
  }



#controlPanel {
  position: absolute;
  bottom: -14px;
  left: 0;
  width: 101%;
  height: 18.5%;
  border-radius:20px;
  background-color: rgba(128,128,128,0.5);
  z-index: 1;
  pointer-events: none; 
  display: none;
}



#scoreContainer {
  position: absolute;
  top: 10px;
  right: 15px;
  color: #00ffcc;
  font-family: 'Arial Black', sans-serif;
  text-shadow: 0 0 6px #00ffff, 0 0 10px #00ffff;
  font-size: 18px;
  text-align: right;
  user-select: none; /* ØªØ§ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø¨Ø§Ø´Ø¯ */
}

#scoreLabel {
  font-size: 14px;
  opacity: 0.8;
}

#scoreValue {
  font-size: 22px;
  font-weight: bold;
}

#pauseBtn {
  position: absolute;
  top: 5%;
  left: 5%;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: none;
  background: radial-gradient(circle at center, #0ff, #00f);
  color: white;
  font-weight: bold;
  font-size: 14px;
  opacity: 0.7;
  cursor: pointer;
  box-shadow: 0 0 15px #0ff, 0 0 30px #0ff inset;
  transition: all 0.2s ease;
}

#pauseBtn:hover {
  box-shadow: 0 0 25px #0ff, 0 0 50px #0ff inset;
}



</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<button id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
<button id="scoreBtn">Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</button>
<div id="creatorName">Created by Mohsen Forghani</div>
<button id="missileBtn" style="position:absolute; bottom:11%; left:2.5%; width:60px; height:40px; background:gray; color:white; border-radius:20px; font-weight:bold;" disabled>ğŸš€</button>
<div id="gameTitle">BERMOODA</div>
<div id="controlPanel"></div>

<!-- ğŸ® Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ -->
<div id="joystick">
  <div id="stick"></div>
</div>
<div id="shoot">ğŸ”¥</div>

 <div id="loadingScreen">
<div id="logoText">BERMOODA</div>
<div id="subLogoText">A GAME BY MOHSEN</div>
    <div id="loadingText">Loading...</div>
    <div id="progressBar">
      <div id="progressFill"></div>
    </div>
  </div>



<div id="scoreContainer">
  <div id="scoreLabel">Score :</div>
  <div id="scoreValue">0</div>
</div>


<button id="pauseBtn" style="display:none;">Pause</button>


<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let airplane = { x: canvas.width / 2, y: canvas.height - 200, w: 50, h: 50 };
let bullets = [];
let enemies = [];
let score = 0;
let gameRunning = false;
const pauseBtn = document.getElementById("pauseBtn");
let paused = false;
let pauseTime = 0;
pauseBtn.addEventListener("click", () => {
    if (!paused) {
        paused = true;
        pauseTime = performance.now(); // Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…Ø§Ù† Pause
        pauseBtn.innerText = "Play";
    } else {
        paused = false;
        const now = performance.now();
        lastTime += (now - pauseTime); // Ø§ØµÙ„Ø§Ø­ lastTime Ø¨Ø¹Ø¯ Ø§Ø² Resume
        pauseBtn.innerText = "Pause";
        requestAnimationFrame(gameLoop); // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø²ÛŒ
    }
});


let gameOverBackground = false;
let lives = 3;
let dx = 0, dy = 0; 
let explosionRunning = false;
let fuel = 100; // Ù…Ù‚Ø¯Ø§Ø± Ø³ÙˆØ®Øª Ø¨ÛŒÙ† 0 ØªØ§ 100
let lastFuelSpawn = Date.now();
let fuels = [];
let lastShotTime = 0;
const shootDelay = 70; // Ù‡Ø± 80 Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡ ÛŒÚ© Ú¯Ù„ÙˆÙ„Ù‡
let explosions = []; // Ø§Ù†ÙØ¬Ø§Ø±Ù‡Ø§
let lastTime = performance.now();
// Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ ÙØ§ÛŒÙ„
let refueling = false; // Ø¢ÛŒØ§ Ø³ÙˆØ®ØªÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø§Ø³ØªØŸ
let refuelRate = 0.4; // Ù…ÛŒØ²Ø§Ù† Ø³ÙˆØ®Øª Ø¯Ø± Ù‡Ø± ÙØ±ÛŒÙ… Ù‡Ù†Ú¯Ø§Ù… Ø³ÙˆØ®ØªÚ¯ÛŒØ±ÛŒ
const explosionImg = new Image();
explosionImg.src = "explosion.png"; // Ù…Ø³ÛŒØ± ØªØµÙˆÛŒØ± Ø§Ù†ÙØ¬Ø§Ø±
let enemyBullets = [];
let bulletSpeed = 5; // Ù…Ù‚Ø¯Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
let displayedFuel = 100; // Ù…Ù‚Ø¯Ø§Ø± Ø¨Ù†Ø²ÛŒÙ†ÛŒ Ú©Ù‡ ÙØ¹Ù„Ø§Ù‹ Ø±ÙˆÛŒ Ú¯ÛŒØ¬ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
const noFlyZoneHeight = 100; // Ø§Ø±ØªÙØ§Ø¹ Ù†Ø§Ø­ÛŒÙ‡ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡
// ØªØ¹Ø±ÛŒÙ Ø¢Ø±Ø§ÛŒÙ‡ Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² ØªØ§Ø¨Ø¹ (ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ø³Ø§Ø®ØªÙ‡ Ø´ÙˆÙ†Ø¯)
const stars = [];
function createStars(num = 50) {
  stars.length = 0;
  for (let i = 0; i < num; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.7 ,
      alpha: Math.random(),
      speed: Math.random() * 0.02 + 0.01
    });
  }
}



const missileImages = [
  "mooshak.png",
  "mooshak2.png",
  //"mooshak3.png",
  //"mooshak4.png"
].map(src => {
  const img = new Image();
  img.src = src;
  return img;
});


let missiles = 0; // ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§
let activeMissiles = []; // Ù„ÛŒØ³Øª Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø±Ú©Øª
let missileBtn = document.getElementById("missileBtn");
// âœ… Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… ØªØµØ§ÙˆÛŒØ±
const imageSources = [
  "airplane.png",
  "explosion.png",
  "fuel.png",
  "mooshak.png", 
"mooshak2.png", 
  "plane1.png", "plane2.png", "plane3.png", "plane4.png",
  "plane6.png", "plane8.png", "plane10.png", "plane12.png",
  "cloud1.png", "cloud2.png", "cloud3.png"
];

let loadedImages = {};
let loadedCount = 0;
const totalImages = imageSources.length;
const loadingText = document.getElementById("loadingText");
const progressFill = document.getElementById("progressFill");
const loadingScreen = document.getElementById("loadingScreen");



let keys = {
  left: false,
  right: false,
  up: false,
  down: false,
  space: false
};


const airplaneImg = new Image();
airplaneImg.src = "airplane.png"; 
// âœˆï¸ ØªØµØ§ÙˆÛŒØ± Ø¯Ø´Ù…Ù†â€ŒÙ‡Ø§
const enemyImages = [
  "plane1.png",
  "plane2.png",
  "plane3.png",
  "plane4.png",
  "plane6.png",
  "plane8.png",
  "plane10.png",
  "plane12.png",
].map(src => {
  const img = new Image();
  img.src = src;
  return img;
});



let shootInterval = null;
const shootBtn = document.getElementById("shoot");







  // ğŸ¨ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú© Ø¢Ø³Ù…Ø§Ù†
let clouds = [];
const cloudImages = ["cloud1.png", "cloud2.png", "cloud3.png"].map(src => {
  const img = new Image();
  img.src = src;
  return img;
});

// Ø³Ø§Ø®Øª Ú†Ù†Ø¯ Ø§Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙ‚Ø¹ÛŒØª ØªØµØ§Ø¯ÙÛŒ
for (let i = 0; i < 6; i++) {
  clouds.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    speed: 0.2 + Math.random() * 0.5,
    img: cloudImages[Math.floor(Math.random() * cloudImages.length)],
    size: 60 + Math.random() * 100
  });
}



function preloadImages(callback) {
 document.getElementById("scoreContainer").style.display = "none";
  imageSources.forEach(src => {
    const img = new Image();
    img.onload = () => {
      loadedImages[src] = img;
      loadedCount++;
      const percent = Math.floor((loadedCount / totalImages) * 100);
      progressFill.style.width = percent + "%";
      loadingText.innerText = `Loading  ${percent} %`;
      if (loadedCount === totalImages) {
      
setTimeout(() => {
      const playerName = prompt("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
        if (playerName) {
        console.log("Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†:", playerName);
      //document.getElementById("playerNameDisplay").textContent = playerName;
}
          callback();
        }, 400); 
      }
    };
    img.onerror = () => {
      console.warn("Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±:", src);
      loadedCount++;
      if (loadedCount === totalImages) callback();
    };
    img.src = src;
  });
}

// âœ… ÙˆÙ‚ØªÛŒ Ù‡Ù…Ù‡ ØªØµØ§ÙˆÛŒØ± Ù„ÙˆØ¯ Ø´Ø¯Ù†:
preloadImages(() => {
  //loadingText.innerText = "Ù…Ø§Ù…ÙˆØ±ÛŒØª ...Ù†Ø§Ø¨ÙˆØ¯ÛŒ Ù†Ø§ÙˆÚ¯Ø§Ù† Ù‡ÙˆØ§ÛŒÛŒ Ø§Ø³Ø±Ø§Ø¦ÛŒÙ„!";
  progressFill.style.width = "100%";

  setTimeout(() => {
    loadingScreen.style.opacity = 0;
    loadingScreen.style.transition = "opacity 0.8s ease";
    loadingScreen.remove();




    startBtn.style.display = "block";
    scoreBtn.style.display = "block";
    document.getElementById("gameTitle").style.display = "block";
    document.getElementById("joystick").style.display = "none";
    document.getElementById("shoot").style.display = "none";
    document.getElementById("missileBtn").style.display = "none";


  }, 700);
});

  startBtn.onclick = () => {
  startBtn.style.display = "none";
  startGame();
};



function drawLives() {
 if (!gameRunning) return;
 const size = 22; // ğŸ”¹ Ú©ÙˆÚ†Ú©ØªØ± Ø§Ø² Ù‚Ø¨Ù„ (35 â†’ 22)
  const padding = 8; // ÙØ§ØµÙ„Ù‡ Ú©Ù…ÛŒ Ú©Ù…ØªØ± Ø¨Ø±Ø§ÛŒ ØªÙ†Ø§Ø³Ø¨ Ø¨Ù‡ØªØ±

  // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªÙ† Ø¯Ø± ÙˆØ³Ø· ØµÙØ­Ù‡
  const totalWidth = lives * size + (lives - 1) * padding;
  const startX = (canvas.width - totalWidth) / 2;
  const y = canvas.height - size - (canvas.height*0.13); // Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø§ Ú©Ù…ÛŒ ÙØ§ØµÙ„Ù‡ Ø§Ø² Ù„Ø¨Ù‡

  for (let i = 0; i < lives; i++) {
    ctx.drawImage(airplaneImg, startX + i * (size + padding), y, size, size);
  }
}




// ğŸŒŒ ØªØ§Ø¨Ø¹ Ø±Ø³Ù… Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
function drawBackground() {
  if (gameOverBackground) {
    // ğŸŒŒ Ø­Ø§Ù„Øª Ø´Ø¨
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, "#000040"); // Ø¢Ø³Ù…Ø§Ù† ØªÛŒØ±Ù‡
    grad.addColorStop(1, "#000000");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    createStars(80);
    // âœ¨ Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÙˆØ³Ùˆ Ø²Ù†
    stars.forEach(s => {
      s.alpha += s.speed;          // ØªØºÛŒÛŒØ± Ø±ÙˆØ´Ù†Ø§ÛŒÛŒ
      if (s.alpha >= 1 || s.alpha <= 0) s.speed *= -1; // Ù…Ø¹Ú©ÙˆØ³ Ú©Ø±Ø¯Ù† Ø¬Ù‡Øª Ø³ÙˆØ³Ùˆ

      ctx.fillStyle = `rgba(255, 255, ${200 + Math.random()*55}, ${s.alpha})`;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fill();
    });

    // â˜ï¸ Ø§Ø¨Ø±Ù‡Ø§
    clouds.forEach(c => {
      c.y += c.speed; // Ø­Ø±Ú©Øª Ø§Ø¨Ø±
      if (c.y > canvas.height + 100) {
        c.y = -100;
        c.x = Math.random() * canvas.width;
      }
      ctx.globalAlpha = 0.5;
      ctx.drawImage(c.img, c.x, c.y, c.size, c.size * 0.6);
      ctx.globalAlpha = 1;
    });

  } else {
    // ğŸŒ¤ï¸ Ø­Ø§Ù„Øª Ø±ÙˆØ²
    const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grad.addColorStop(0, "#4da6ff");
    grad.addColorStop(1, "#003366");
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // â˜ï¸ Ø§Ø¨Ø±Ù‡Ø§
    clouds.forEach(c => {
      c.y += c.speed;
      if (c.y > canvas.height + 100) {
        c.y = -100;
        c.x = Math.random() * canvas.width;
      }
      ctx.globalAlpha = 0.5;
      ctx.drawImage(c.img, c.x, c.y, c.size, c.size * 0.6);
      ctx.globalAlpha = 1;
    });
  }
}


document.addEventListener("keydown", (e) => {
  if (!gameRunning) return;
  switch (e.code) {
    case "ArrowLeft": keys.left = true; break;
    case "ArrowRight": keys.right = true; break;
    case "ArrowUp": keys.up = true; break;
    case "ArrowDown": keys.down = true; break;
    case "Space": keys.space = true; break;
  }
});

document.addEventListener("keyup", (e) => {
  switch (e.code) {
    case "ArrowLeft": keys.left = false; break;
    case "ArrowRight": keys.right = false; break;
    case "ArrowUp": keys.up = false; break;
    case "ArrowDown": keys.down = false; break;
    case "Space": keys.space = false; break;
  }
});













function drawFuelGaugeAnimated() {
  if (!gameRunning) return;  

  const centerX = canvas.width / 2;
  const centerY = canvas.height - 20;
  const radius = 60;

  // ğŸ”¹ Ø±Ø³Ù… Ù†ÛŒÙ…â€ŒØ¯Ø§ÛŒØ±Ù‡ Ù¾Ø§ÛŒÙ‡
  ctx.beginPath();
  ctx.arc(centerX, centerY, radius, Math.PI, 2 * Math.PI);
  ctx.lineWidth = 20;
  ctx.strokeStyle = "#333";
  ctx.stroke();

  // ğŸ”¹ Ø§ÙÚ©Øª Ú†Ø´Ù…Ú© Ø²Ù† Ù‚Ø±Ù…Ø² ÙˆÙ‚ØªÛŒ Ø³ÙˆØ®Øª â‰¤ 10Ùª
  if (fuel <= 20) {
    const fade = 0.3 + 0.7 * Math.abs(Math.sin(Date.now() / 300)); // 0.3 ØªØ§ 1
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius - 10, Math.PI, 2 * Math.PI);
    ctx.lineWidth = 16;
    ctx.strokeStyle = `rgba(255,0,0,${fade})`;
    ctx.stroke();
  }

  // ğŸ”¹ Ø®Ø·ÙˆØ· Ø¯Ø±Ø¬Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø¶Ù„Ø¹ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ù†ÛŒÙ…â€ŒØ¯Ø§ÛŒØ±Ù‡
  const totalTicks = 100;
  for (let i = 0; i <= totalTicks; i++) {
    const angle = Math.PI + (i / totalTicks) * Math.PI;
    const outerRadius = radius - 2; // Ø¶Ù„Ø¹ Ø¨Ø§Ù„Ø§ÛŒÛŒ Ø¯Ø§Ø®Ù„ÛŒ
    const innerRadius = (i % 10 === 0) ? outerRadius - 10 : outerRadius - 5; // Ø§ØµÙ„ÛŒ Ùˆ ÙØ±Ø¹ÛŒ
    const x1 = centerX + innerRadius * Math.cos(angle);
    const y1 = centerY + innerRadius * Math.sin(angle);
    const x2 = centerX + outerRadius * Math.cos(angle);
    const y2 = centerY + outerRadius * Math.sin(angle);

    ctx.strokeStyle = (i % 10 === 0) ? "#00ffff" : "rgba(0,255,255,0.3)"; // Ø®Ø·ÙˆØ· ÙØ±Ø¹ÛŒ Ø´ÙØ§Ù
    ctx.lineWidth = (i % 10 === 0) ? 2 : 1; 
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }

  // ğŸ”¹ Ù…ØªÙ† E Ùˆ F
  ctx.font = "18px Arial Black";
  ctx.fillStyle = "#00ffff";
  ctx.textAlign = "center";
  ctx.fillText("E", centerX - radius-7, centerY + 10);
  ctx.fillText("F", centerX + radius+7, centerY + 10);

  // ğŸ”¹ Ø¯Ø±ØµØ¯ Ø³ÙˆØ®Øª
  ctx.font = "12px Arial";
  ctx.fillStyle = (fuel <= 10) ? "red" : "#00ffff";
  ctx.fillText(Math.round(fuel) + "%", centerX, centerY - 10);

  // ğŸ”¹ Smooth animation Ø¹Ù‚Ø±Ø¨Ù‡
  const speed = 0.025;
  displayedFuel += (fuel - displayedFuel) * speed;
  const needleAngle = Math.PI + (displayedFuel / 100) * Math.PI;
  const needleLength = radius - 10;
  const needleX = centerX + needleLength * Math.cos(needleAngle);
  const needleY = centerY + needleLength * Math.sin(needleAngle);

  // ğŸ”¹ Ø¹Ù‚Ø±Ø¨Ù‡ Ø«Ø§Ø¨Øª
  ctx.beginPath();
  ctx.moveTo(centerX, centerY);
  ctx.lineTo(needleX, needleY);
  ctx.lineWidth = 4;
  ctx.strokeStyle = "#ff0000";
  ctx.stroke();

  // ğŸ”¹ Ø¯Ø§ÛŒØ±Ù‡ Ù…Ø±Ú©Ø² Ø¹Ù‚Ø±Ø¨Ù‡
  ctx.beginPath();
  ctx.arc(centerX, centerY, 6, 0, 2 * Math.PI);
  ctx.fillStyle = "#ff0000";
  ctx.fill();
}





























  
// === Ø­Ù„Ù‚Ù‡ Ø¨Ø§Ø²ÛŒ ===
function gameLoop() {
  if (!gameRunning || paused) return;
  drawBackground();
  const now = performance.now();
  const delta = (now - lastTime) / 16.67; 
  lastTime = now;
  //ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  airplane.x += dx * 4;
  airplane.y += dy * 4;
  airplane.x = Math.max(0, Math.min(canvas.width - airplane.w, airplane.x));
  airplane.y = Math.max(0, Math.min(canvas.height - airplane.h, airplane.y));

// ğŸŒŸ Ø­Ø§Ù„Øª Ù…ØªÙ…Ø§ÛŒÙ„ Ø´Ø¯Ù†: -1: Ú†Ù¾ØŒ 0: ØµØ§ÙØŒ 1: Ø±Ø§Ø³Øª
if (!airplane.direction) airplane.direction = 0;
if (!airplane.tiltProgress) airplane.tiltProgress = 0;

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ tiltProgress Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù†Ø±Ù…
airplane.tiltProgress += (airplane.direction - airplane.tiltProgress) * 0.3; // 0.3 Ø³Ø±Ø¹Øª Ù…ØªÙ…Ø§ÛŒÙ„ Ø´Ø¯Ù†

if (!airplane.hidden) {
  ctx.save();
  const tiltFactor = 1 + 0.3 * airplane.tiltProgress; // 0.3 Ù…Ù‚Ø¯Ø§Ø± Ú©Ø´Ø´ Ø§ÙÙ‚ÛŒ
  const w = airplane.w * tiltFactor;
  const h = airplane.h;
  const x = airplane.x - (w - airplane.w)/2; // Ù…Ø±Ú©Ø² Ú©Ø±Ø¯Ù† ØªØµÙˆÛŒØ±
  ctx.drawImage(airplaneImg, x, airplane.y, w, h);
  ctx.restore();
}

// ğŸ”« Ø±Ø³Ù… Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§
bullets.forEach((b, i) => {
  if (score > 200) bulletSpeed = 5;
  if (score > 400) bulletSpeed = 5;
  if (score > 800) bulletSpeed = 5;

b.y -= bulletSpeed;
  ctx.fillStyle = "yellow";
  ctx.fillRect(b.x - 2, b.y, 1.8, 4.2);
  if (b.y < 0) bullets.splice(i, 1);
});



for (let i = activeMissiles.length - 1; i >= 0; i--) {
  let m = activeMissiles[i];

  // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù‚Ø¨Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ø§ÙˆÛŒÙ‡
  m.prevX = m.x;
  m.prevY = m.y;

  // Ø­Ø±Ú©Øª Ø¹Ù…ÙˆØ¯ÛŒ Ùˆ Ø³ÛŒÙ†ÙˆØ³ÛŒ
  m.y -= m.speed;
  m.angle += 0.05;
  m.x = m.baseX + Math.sin(m.angle) * m.amplitude; 

  // Ø²Ø§ÙˆÛŒÙ‡ Ù…ÙˆØ´Ú© Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ø³ÛŒØ± Ø­Ø±Ú©Øª
  let dx = m.x - m.prevX;
  let dy = m.y - m.prevY;
  let rotation = Math.atan2(dy, dx) - Math.PI/2;

  // Ø±Ø³Ù… Ù…ÙˆØ´Ú© Ø¨Ø§ Ú†Ø±Ø®Ø´
  ctx.save();
  ctx.translate(m.x + m.w/2, m.y + m.h/2);
  ctx.rotate(rotation);
  ctx.drawImage(m.img, -m.w/2, -m.h/2, m.w, m.h);
  ctx.restore();

  // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ù…ÙˆØ´Ú© Ø¨Ø§ ØªÙ…Ø§Ù… Ø¯Ø´Ù…Ù†Ø§Ù†
  for (let j = enemies.length - 1; j >= 0; j--) {
    let e = enemies[j];
    if (
      m.x + m.w/2 > e.x - e.w/2 &&
      m.x - m.w/2 < e.x + e.w/2 &&
      m.y + m.h/2 > e.y - e.h/2 &&
      m.y - m.h/2 < e.y + e.h/2
    ) {
      createExplosion(m.x + m.w/2, m.y + m.h/2, m.w, m.h);
      createExplosion(e.x, e.y, e.w, e.h);

      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø´Ù…Ù†
      score += 10;
      document.getElementById("scoreValue").textContent = score;

      // Ø­Ø°Ù Ø¯Ø´Ù…Ù† Ùˆ Ù…ÙˆØ´Ú©
      enemies.splice(j, 1);
      activeMissiles.splice(i, 1);

      enemyBullets = [];
      break; // Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø¯Ø´Ù…Ù†Ø§Ù†
    }
  }

  // Ø§Ú¯Ø± Ù…ÙˆØ´Ú© Ù†Ø²Ø¯ÛŒÚ© Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ø´Ø¯
  if (m.y + m.h < 200) {
    createExplosion(m.x + m.w/2, m.y + m.h/2, 200, 200);

    enemies.forEach(e => createExplosion(e.x, e.y, e.w, e.h));

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¯Ø´Ù…Ù†Ø§Ù† Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡
    score += enemies.length * 10;
    document.getElementById("scoreValue").textContent = score;

    enemies = [];
    enemyBullets = [];
    activeMissiles.splice(i, 1);
  }
}




if (keys.left) {
  airplane.x -= 5;
  airplane.direction = -1; // Ù…ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ú†Ù¾
} else if (keys.right) {
  airplane.x += 5;
  airplane.direction = -1; // Ù…ØªÙ…Ø§ÛŒÙ„ Ø¨Ù‡ Ø±Ø§Ø³Øª
} else {
  airplane.direction = 0; // ØµØ§Ù
}
if (keys.up) airplane.y -= 5;
if (keys.down) airplane.y += 5;

// Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ø­Ø±Ú©Øª
if (airplane.x < 0) airplane.x = 0;
if (airplane.x + airplane.w > canvas.width)
  airplane.x = canvas.width - airplane.w;
if (airplane.y < 0) airplane.y = 0;
if (airplane.y + airplane.h > canvas.height-noFlyZoneHeight)
  airplane.y = canvas.height - airplane.h-noFlyZoneHeight;




if (Math.random() < 0.005) {
  const padding = 30;
  const enemy = {
    x: Math.random() * (canvas.width - 2 * padding) + padding,
    y: -60,
    w: 42,
    h: 42,
    img: enemyImages[Math.floor(Math.random() * enemyImages.length)],
    canShoot: Math.random() < 0.18,
    lastShotTime: 0,
    shotCount: 0,
    spiral: Math.random() < 0.3,   // ğŸ¯ 30% Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø§Ø±Ù¾ÛŒÚ†ÛŒ Ø¨ÙˆØ¯Ù†
    angle: 0,                      // Ø²Ø§ÙˆÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ø³ÛŒÙ†ÙˆØ³ÛŒ
    amplitude: 60,                 // Ø¯Ø§Ù…Ù†Ù‡ Ø§Ù†Ø­Ø±Ø§Ù Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª
    speed: 1                       // Ø³Ø±Ø¹Øª Ø­Ø±Ú©Øª Ø¹Ù…ÙˆØ¯ÛŒ
  };
  enemies.push(enemy);
}





// ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ®Øª Ù‡Ø± 20 Ø«Ø§Ù†ÛŒÙ‡
if (Date.now() - lastFuelSpawn > 15000) {
  fuels.push({
    x: Math.random() * (canvas.width - 80) + 40,
    y: -50,
    w: 25,
    h: 60
  });
  lastFuelSpawn = Date.now();
}


enemies.forEach((e, i) => {
   ctx.drawImage(e.img, e.x - e.w / 2, e.y - e.h / 2, e.w, e.h);
   if (e.spiral) {
  e.y += e.speed * delta;
  e.angle += 0.05 * delta; // Ø³Ø±Ø¹Øª Ú†Ø±Ø®Ø´ Ù…ÙˆØ¬
  e.x += Math.sin(e.angle) * 3 * delta; // Ø­Ø±Ú©Øª Ø³ÛŒÙ†ÙˆØ³ÛŒ Ø¨Ù‡ Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª
} else {
  e.y += e.speed;
}
// ğŸ”¹ Ø­Ø°Ù Ø¯Ø´Ù…Ù† ÙˆÙ‚ØªÛŒ 100 Ù¾ÛŒÚ©Ø³Ù„ ØªØ§ Ù¾Ø§ÛŒÛŒÙ† ÙØ§ØµÙ„Ù‡ Ø¯Ø§Ø±Ø¯
  if (e.y > canvas.height - noFlyZoneHeight) {
    enemies.splice(i, 1);
  }

// Ø´Ù„ÛŒÚ© Ø¯Ø´Ù…Ù†
  if (e.canShoot) {
    const now = Date.now();
    if (now - e.lastShotTime > 1500 && e.shotCount < 2) { // Ù‡Ø± 1 Ø«Ø§Ù†ÛŒÙ‡ ÛŒÚ© ØªÛŒØ±ØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 3 ØªÛŒØ±
      enemyShoot(e);
      e.lastShotTime = now;
      e.shotCount++;
    }
    // Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ 3 ØªÛŒØ± Ø²Ø¯ØŒ 3 Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù† Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø´Ù„ÛŒÚ© Ú©Ù†Ù‡
    if (e.shotCount >= 2 && now - e.lastShotTime > 4000) {
      e.shotCount = 0;
    }
  }
enemyBullets.forEach((b, i) => {
  b.y += b.vy * delta;
  ctx.fillStyle = "white";
  ctx.fillRect(b.x - 2, b.y, 1.8, 4.2);

  // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§
  if (
    airplane.x < b.x && airplane.x + airplane.w > b.x &&
    airplane.y < b.y && airplane.y + airplane.h > b.y
  ) {
    explodeAirplane();
    enemyBullets.splice(i, 1);
  }

  // Ø­Ø°Ù Ú¯Ù„ÙˆÙ„Ù‡ Ø§Ú¯Ø± Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† ØµÙØ­Ù‡ Ø®Ø§Ø±Ø¬ Ø´Ø¯
  if (b.y > canvas.height-noFlyZoneHeight) enemyBullets.splice(i, 1);
});




  // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ú¯Ù„ÙˆÙ„Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¯Ø´Ù…Ù†
  bullets.forEach((b, j) => {
    if (
      b.x > e.x - e.w/2 &&
      b.x < e.x + e.w/2 &&
      b.y > e.y - e.h/2 &&
      b.y < e.y + e.h/2
    ) {
      createExplosion(e.x, e.y, e.w, e.h); // Ø§Ù†ÙØ¬Ø§Ø± ØªØ±Ú©ÛŒØ¨ÛŒ
      enemies.splice(i, 1);
      bullets.splice(j, 1);
      score += 10;
      document.getElementById("scoreValue").textContent = score;

// Ù‡Ø± 50 Ø§Ù…ØªÛŒØ§Ø² ÛŒÚ© Ù…ÙˆØ´Ú©
let newMissiles = Math.floor(score / 50);
if(newMissiles > missiles) {
  missiles = newMissiles;
  updateMissileBtn(); // Ù…ØªÙ† Ø¯Ú©Ù…Ù‡ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´ÙˆØ¯
}


    }
  });

  // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ Ø¨Ø§ Ø¯Ø´Ù…Ù†
  if (
    airplane.x < e.x + e.w / 2 &&
    airplane.x + airplane.w > e.x - e.w / 2 &&
    airplane.y < e.y + e.h / 2 &&
    airplane.y + airplane.h > e.y - e.h / 2
  ) {
 // Ø§Ù†ÙØ¬Ø§Ø± Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ÛŒ Ø¯Ø´Ù…Ù†
  createExplosion(e.x, e.y, e.w, e.h);
    explodeAirplane();
    enemies.splice(i, 1);
   // endGame();
  }
});



const fuelImg = new Image();
fuelImg.src = "fuel.png"; // Ù…Ø³ÛŒØ± ØªØµÙˆÛŒØ± Ù¾Ù…Ù¾ Ø¨Ù†Ø²ÛŒÙ†Øª

fuels.forEach((f, i) => {
  f.y += 0.4; // Ø­Ø±Ú©Øª Ù¾Ø§ÛŒÛŒÙ† Ù¾Ù…Ù¾

  // Ø±Ø³Ù… ØªØµÙˆÛŒØ± Ù¾Ù…Ù¾
  ctx.drawImage(fuelImg, f.x, f.y, f.w, f.h);

  // ğŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ®ØªÚ¯ÛŒØ±ÛŒ ØªØ¯Ø±ÛŒØ¬ÛŒ
  if (
    airplane.x < f.x + f.w &&
    airplane.x + airplane.w > f.x &&
    airplane.y < f.y + f.h &&
    airplane.y + airplane.h > f.y
  ) {
    // Ù‡Ø± ÙØ±ÛŒÙ… Ø³ÙˆØ®Øª Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    fuel += 0.4; // Ù…ÛŒØ²Ø§Ù† Ø³ÙˆØ®ØªÚ¯ÛŒØ±ÛŒ Ø¯Ø± Ù‡Ø± ÙØ±ÛŒÙ…ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù† ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯
    if (fuel > 100) fuel = 100;
  }

  // ğŸ”¹ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ú¯Ù„ÙˆÙ„Ù‡ Ø¨Ø§ Ù¾Ù…Ù¾
  bullets.forEach((b, j) => {
    if (
      b.x > f.x &&
      b.x < f.x + f.w &&
      b.y > f.y &&
      b.y < f.y + f.h
    ) {
      fuels.splice(i, 1); // Ø­Ø°Ù Ù¾Ù…Ù¾
      bullets.splice(j, 1); // Ø­Ø°Ù Ú¯Ù„ÙˆÙ„Ù‡
     score+=10
     document.getElementById("scoreValue").textContent = score;
    }
  });

  // Ø­Ø°Ù Ù¾Ù…Ù¾ Ø§Ú¯Ø± Ø§Ø² Ù¾Ø§ÛŒÛŒÙ† Ø®Ø§Ø±Ø¬ Ø´Ø¯
  if (f.y > canvas.height) fuels.splice(i, 1);
});



fuel -= 0.02; // Ú©Ø§Ù‡Ø´ ØªØ¯Ø±ÛŒØ¬ÛŒ Ø³ÙˆØ®Øª
if (fuel < 0) {
  fuel = 0;
  endGame();
}




// ğŸ”« Ú©Ù†ØªØ±Ù„ Ø´Ù„ÛŒÚ© Space Ø¯Ø± Ø­Ù„Ù‚Ù‡ Ø¨Ø§Ø²ÛŒ
if (keys.space) {
  const now = Date.now();
  if (now - lastShotTime > shootDelay) {
    shoot();
    lastShotTime = now;
  }
}
  

for (let i = explosions.length - 1; i >= 0; i--) {
  const ex = explosions[i];

  const scale = 1 + (1 - ex.alpha);
  const w = ex.w * scale;
  const h = ex.h * scale;
  const x = ex.x - (w - ex.w)/2;
  const y = ex.y - (h - ex.h)/2;

  ctx.globalAlpha = ex.alpha;
  ctx.drawImage(explosionImg, x, y, w, h);

  ex.particles.forEach(p => {
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, p.w, p.h);
    p.x += p.vx;
    p.y += p.vy;
    p.vx *= 0.9;
    p.vy *= 0.9;
  });

  ctx.globalAlpha = 1;

  ex.alpha -= ex.fadeRate;
  if (ex.alpha <= 0) {
    explosions.splice(i, 1);
    if (ex.callback) ex.callback(); // ğŸ”¹ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒØ´Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø§Ù†ÙØ¬Ø§Ø±
  }
}

  drawFuelGaugeAnimated();
  drawLives();
  requestAnimationFrame(gameLoop);
} 


// === Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ ===
function shoot() {
  if(!gameRunning) return;
  bullets.push({x:airplane.x+airplane.w/2,y:airplane.y});
}

function enemyShoot(enemy) {
  enemyBullets.push({
    x: enemy.x,
    y: enemy.y + enemy.h / 2,
    vx: 0,
    vy: 2
  });
}

function updateMissileBtn() {
  missileBtn.innerText = `ğŸš€ ${missiles}`;
  missileBtn.disabled = missiles <= 0;
}

function launchMissile() {
  if (missiles <= 0 || !gameRunning) return;
  missiles--;
  updateMissileBtn();
  enemyBullets = [];

// ğŸ¯ Ø§Ù†ØªØ®Ø§Ø¨ ØªØµØ§Ø¯ÙÛŒ Ø¨ÛŒÙ† Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ù…ÙˆØ´Ú©
const missileImage = missileImages[Math.floor(Math.random() * missileImages.length)];


  activeMissiles.push({
    x: airplane.x + airplane.w / 2 - 10,
    y: airplane.y - 10,
    w: 10,
    h: 35,
    speed: 3,
    angle: 0,
    amplitude: 50,
    prevX: airplane.x + airplane.w / 2 - 10,
    prevY: airplane.y - 10,
    baseX: airplane.x + airplane.w / 2 - 10,
    img: missileImage // âœ… Ø°Ø®ÛŒØ±Ù‡ ØªØµÙˆÛŒØ± ØªØµØ§Ø¯ÙÛŒ
  });
}




function startGame() {
  if (explosionRunning) return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø§Ù†ÙØ¬Ø§Ø±
  document.getElementById("scoreContainer").style.display = "block";
  const controlPanel = document.getElementById('controlPanel');
  gameOverBackground = false;
  airplane.hidden = false;
  lives = 3;
  score = 0;
  document.getElementById("scoreValue").textContent = score;
  fuel = 100;
  paused = false;
  bulletSpeed = 5;
  airplane.x = canvas.width / 2 - (airplane.w)/2;
  airplane.y = canvas.height - 200;
  enemies = [];
  bullets = [];
  fuels = []; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø³ÙˆØ®Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡
  enemyBullets = []; // âœ… Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… ØªÛŒØ±Ù‡Ø§ÛŒ Ø¯Ø´Ù…Ù†
  lastFuelSpawn = Date.now(); // Ø±ÛŒØ³Øª ØªØ§ÛŒÙ…Ø± ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ®Øª
  missiles = 0;              // â† ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§ ØµÙØ±
  updateMissileBtn();        // â† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ú©Ù…Ù‡
  gameRunning = true;
  document.getElementById("startBtn").style.display = "none";
  document.getElementById("scoreBtn").style.display = "none";
  document.getElementById("joystick").style.display = "block";
  document.getElementById("shoot").style.display = "block";
  document.getElementById("gameTitle").style.display = "none";
  document.getElementById("missileBtn").style.display = "block";
  pauseBtn.style.display = "block";
  requestAnimationFrame(gameLoop);
}


  function endGame() {
  gameRunning = false;
    enemies = [];
    bullets = [];
    fuels = [];
    enemyBullets = [];
    activeMissiles = [];
    explosions = [];

  gameOverBackground = true;
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡ Ù‚Ø¨Ù„ Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ†
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.getElementById("scoreContainer").style.display = "none";
  controlPanel.style.display = 'none'; 
  pauseBtn.style.display = "none";
  // ğŸŒŸ Ù…ØªÙ† Game Over Ù‚Ø±Ù…Ø² Ø¯Ø±Ø®Ø´Ø§Ù†
  const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
  gradient.addColorStop(0, "#ff0000");
  gradient.addColorStop(0.5, "#ff4d4d");
  gradient.addColorStop(1, "#ff0000");
  drawBackground();
  ctx.save();
  ctx.fillStyle = gradient;
  ctx.shadowColor = "red";
  ctx.shadowBlur = 30;
  ctx.font = "bold 50px Arial Black";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2.6);


  // ğŸŒŸ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†
  ctx.shadowColor = "white";
  ctx.shadowBlur = 10;
  ctx.fillStyle = "white";
  ctx.font = "bold 32px Arial";
  ctx.fillText("Your Score : " + score, canvas.width*0.5, canvas.height*0.47 );

  ctx.restore();

  explosionRunning = false;

  const startBtn = document.getElementById("startBtn");
  const scoreBtn = document.getElementById("scoreBtn");
  startBtn.style.display = "block";
  scoreBtn.style.display = "block";
  document.getElementById("joystick").style.display = "none";
  document.getElementById("shoot").style.display = "none";
  document.getElementById("missileBtn").style.display = "none";
}





function createExplosion(x, y, w=70, h=70) {
  const particles = [];
  const numParticles = 20; // ØªØ¹Ø¯Ø§Ø¯ Ø°Ø±Ø§Øª
  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: x,
      y: y,
      vx: (Math.random() - 0.5) * 12,
      vy: (Math.random() - 0.5) * 12,
      w: Math.random() * 3 + 2,
      h: Math.random() * 3 + 2,
      color: ["orange","red","yellow","gray"][Math.floor(Math.random()*4)]
    });
  }

  explosions.push({
    x: x - w/2,
    y: y - h/2,
    w: w,
    h: h,
    alpha: 1,
    fadeRate: 0.03,
    particles: particles
  });

  if (navigator.vibrate) navigator.vibrate(50); // ÙˆÛŒØ¨Ø±Ù‡ Ú©ÙˆØªØ§Ù‡
}





function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas(); // Ø§Ø¬Ø±Ø§ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§

function explodeAirplane() {
  if (explosionRunning) return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ÙØ¬Ø§Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡
  explosionRunning = true;

  if (navigator.vibrate) navigator.vibrate(200);

  const x = airplane.x + airplane.w / 2;
  const y = airplane.y + airplane.h / 2;
  const w = airplane.w;
  const h = airplane.h;

  // ØªÙˆÙ„ÛŒØ¯ Ø°Ø±Ø§Øª Ø§Ù†ÙØ¬Ø§Ø±
  const particles = [];
  const numParticles = 60;
  for (let i = 0; i < numParticles; i++) {
    particles.push({
      x: x,
      y: y,
      vx: (Math.random() - 0.5) * 12,
      vy: (Math.random() - 0.5) * 12,
      w: Math.random() * 8 + 2,
      h: Math.random() * 8 + 2,
      color: ["orange", "red", "yellow", "gray"][Math.floor(Math.random() * 4)]
    });
  }

  explosions.push({
    x: x - w / 2,
    y: y - h / 2,
    w: w,
    h: h,
    alpha: 1,
    fadeRate: 0.03,
    particles: particles
  });

  // Ú©Ø§Ù‡Ø´ Ø¬Ø§Ù† Ø¨Ø§Ø²ÛŒÚ©Ù†
  lives--;

  // ğŸ”¹ Ù†Ø§Ù¾Ø¯ÛŒØ¯ Ú©Ø±Ø¯Ù† Ù…ÙˆÙ‚Øª Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ (Û² Ø«Ø§Ù†ÛŒÙ‡)
  airplane.hidden = true;

  if (lives <= 0) {
    // Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Û² Ø«Ø§Ù†ÛŒÙ‡
    setTimeout(() => {
      endGame();
    }, 2000);
  } else {
    // Ø¨Ø§Ø²Ú¯Ø´Øª Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ Ø¨Ø¹Ø¯ Ø§Ø² Û² Ø«Ø§Ù†ÛŒÙ‡
    setTimeout(() => {
      airplane.x = canvas.width / 2 - 40;
      airplane.y = canvas.height - 200;
      airplane.hidden = false;
      explosionRunning = false;
    }, 2000);
  }
}













// === Ø¬ÙˆÛŒâ€ŒØ§Ø³ØªÛŒÚ© Ù„Ù…Ø³ÛŒ ===
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let touchId = null;

joystick.addEventListener("touchstart", e=>{
  if(touchId!==null) return;
  const touch=[...e.touches].find(t=>{
    const rect=joystick.getBoundingClientRect();
    return t.clientX>=rect.left && t.clientX<=rect.right &&
           t.clientY>=rect.top && t.clientY<=rect.bottom;
  });
  if(touch) touchId=touch.identifier;
});

joystick.addEventListener("touchmove", e=>{
  if(touchId===null) return;
  let touch=[...e.touches].find(t=>t.identifier===touchId);
  if(!touch) return;
  let rect=joystick.getBoundingClientRect();
  let centerX=rect.left+rect.width/2;
  let centerY=rect.top+rect.height/2;
  let tx=touch.clientX-centerX;
  let ty=touch.clientY-centerY;
  const maxDist=40;
  const distance=Math.sqrt(tx*tx+ty*ty);
  if(distance>maxDist){
    tx=tx*maxDist/distance;
    ty=ty*maxDist/distance;
  }
  stick.style.transform=`translate(${tx}px,${ty}px)`;
  dx=tx/maxDist;
  dy=ty/maxDist;
});

joystick.addEventListener("touchend", e=>{
  const remaining=[...e.touches];
  if(!remaining.find(t=>t.identifier===touchId)){
    stick.style.transform="translate(0,0)";
    dx=0; dy=0; touchId=null;
  }
});

// === Ø´Ù„ÛŒÚ© Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† ===
shootBtn.addEventListener("touchstart", e=>{
  if(!gameRunning) return;
  shoot(); 
  shootInterval=setInterval(shoot,110);
});
shootBtn.addEventListener("touchend", e=>{
  clearInterval(shootInterval);
});



// === Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ===
function addTouchAndClick(id, handler){
  const el=document.getElementById(id);
  el.addEventListener("click",handler);
  el.addEventListener("touchstart",e=>{e.preventDefault(); handler();});
}

startBtn.addEventListener('click', () => {
  controlPanel.style.display = 'block'; 
  startGame();
});

addTouchAndClick("shoot",shoot);
addTouchAndClick("missileBtn", launchMissile);
window.addEventListener("resize",()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
});

</script>
</body>
</html>

